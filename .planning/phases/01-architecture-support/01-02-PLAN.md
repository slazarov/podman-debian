---
phase: 01-architecture-support
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified: [scripts/install_go.sh]
autonomous: true
requirements: [ARCH-02]

must_haves:
  truths:
    - "Go installer downloads correct binary for system architecture"
    - "On amd64 system, Go downloads linux-amd64.tar.gz"
    - "On ARM64 system, Go downloads linux-arm64.tar.gz"
  artifacts:
    - path: "scripts/install_go.sh"
      provides: "Architecture-aware Go installation"
      pattern: "GOARCH"
  key_links:
    - from: "scripts/install_go.sh"
      to: "config.sh.example"
      via: "source and variable expansion"
      pattern: "linux-\\$GOARCH"
---

<objective>
Update Go installer to use architecture-aware download URLs.

Purpose: Enable Go installation on both amd64 and ARM64 systems by replacing hardcoded architecture with $GOARCH variable.

Output: Updated scripts/install_go.sh that downloads correct Go binary for the detected architecture.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-architecture-support/01-RESEARCH.md

<interfaces>
<!-- Key interfaces from existing codebase and Plan 01 -->

From config.sh.example (after Plan 01):
```bash
export ARCH="${ARCH:-$(detect_architecture)}"  # "amd64" or "arm64"
export GOARCH="$ARCH"                           # Go uses: amd64, arm64
export GOVERSION="1.23.3"
export GOTAG="go${GOVERSION}"
export GOROOT="/opt/go/${GOVERSION}"
```

From scripts/install_go.sh (current - lines 19-21):
```bash
# Download a Binary Distribution
wget https://go.dev/dl/${GOTAG}.linux-amd64.tar.gz -O ${GOTAG}.linux-amd64.tar.gz
tar xvf ${GOTAG}.linux-amd64.tar.gz --strip-components=1 -C ${GOROOT}
```

Required change (from RESEARCH.md):
```bash
wget "https://go.dev/dl/go${GOVERSION}.linux-${GOARCH}.tar.gz" -O go.tar.gz
tar -xzf go.tar.gz
mv go "${GOROOT}"
```

Go download URL patterns:
- amd64: https://go.dev/dl/go1.23.3.linux-amd64.tar.gz
- arm64: https://go.dev/dl/go1.23.3.linux-arm64.tar.gz
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update install_go.sh to use $GOARCH variable</name>
  <files>scripts/install_go.sh</files>
  <action>
Update scripts/install_go.sh to use the $GOARCH variable instead of hardcoded `amd64`.

Current code (lines 19-21):
```bash
# Download a Binary Distribution
wget https://go.dev/dl/${GOTAG}.linux-amd64.tar.gz -O ${GOTAG}.linux-amd64.tar.gz
tar xvf ${GOTAG}.linux-amd64.tar.gz --strip-components=1 -C ${GOROOT}
```

Replace with:
```bash
# Download Go for detected architecture
wget "https://go.dev/dl/${GOTAG}.linux-${GOARCH}.tar.gz" -O go.tar.gz

# Extract
tar -xzf go.tar.gz

# Move to destination (Go tarball extracts to 'go' directory)
mkdir -p "${GOROOT}"
mv go "${GOROOT}"
```

Key changes:
1. Replace hardcoded `amd64` with `${GOARCH}` in URL
2. Use generic output filename `go.tar.gz` instead of architecture-specific name
3. Extract to `go` directory first, then move to GOROOT (cleaner approach)
4. Keep existing `mkdir -p ${GOROOT}` line (line 17) or move it before the mv command

Do NOT change:
- The `source "${toolpath}/config.sh"` line (GOARCH comes from there)
- The `set -e` error handling
- The toolpath detection at the top
  </action>
  <verify>
    <automated>grep -q '\${GOARCH}' /Users/slazarov/Documents/Scripts/Python/zhipu-projects/podman-debian/scripts/install_go.sh && ! grep -q 'linux-amd64' /Users/slazarov/Documents/Scripts/Python/zhipu-projects/podman-debian/scripts/install_go.sh && echo "PASS: GOARCH used, amd64 hardcoded removed" || echo "FAIL: still has hardcoded architecture"</automated>
  </verify>
  <done>install_go.sh uses ${GOARCH} variable in download URL; no hardcoded amd64 references remain in wget command</done>
</task>

</tasks>

<verification>
After completion:
1. Verify wget URL contains ${GOARCH} not hardcoded amd64
2. Verify file references use generic names (go.tar.gz) not architecture-specific
3. Run `bash -n scripts/install_go.sh` to verify syntax is valid
</verification>

<success_criteria>
- [ ] scripts/install_go.sh uses ${GOARCH} in download URL
- [ ] No hardcoded architecture references (amd64, x86_64) in install_go.sh
- [ ] Script syntax is valid (bash -n passes)
- [ ] Extraction and move commands updated for new filename pattern
</success_criteria>

<output>
After completion, create `.planning/phases/01-architecture-support/01-02-SUMMARY.md`
</output>
