---
phase: 01-architecture-support
plan: 04
type: execute
wave: 2
depends_on: [01-01]
files_modified: [scripts/install_rust.sh]
autonomous: true
requirements: [ARCH-04]

must_haves:
  truths:
    - "Rust installer downloads correct binary for system architecture"
    - "On amd64 system, Rust downloads x86_64-unknown-linux-gnu rustup-init"
    - "On ARM64 system, Rust downloads aarch64-unknown-linux-gnu rustup-init"
  artifacts:
    - path: "scripts/install_rust.sh"
      provides: "Architecture-aware Rust installation"
      pattern: "RUSTUP_ARCH"
  key_links:
    - from: "scripts/install_rust.sh"
      to: "config.sh.example"
      via: "source and variable expansion"
      pattern: "\\$RUSTUP_ARCH"
---

<objective>
Update Rust installer to use architecture-aware download URLs.

Purpose: Enable Rust installation on both amd64 and ARM64 systems by replacing hardcoded architecture target with $RUSTUP_ARCH variable.

Output: Updated scripts/install_rust.sh that downloads correct rustup-init binary for the detected architecture.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-architecture-support/01-RESEARCH.md

<interfaces>
<!-- Key interfaces from existing codebase and Plan 01 -->

From config.sh.example (after Plan 01):
```bash
export ARCH="${ARCH:-$(detect_architecture)}"  # "amd64" or "arm64"
# RUSTUP_ARCH mapping:
#   amd64 -> "x86_64-unknown-linux-gnu"
#   arm64 -> "aarch64-unknown-linux-gnu"
```

From scripts/install_rust.sh (current - lines 16-21):
```bash
#curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

wget https://static.rust-lang.org/rustup/dist/x86_64-unknown-linux-gnu/rustup-init -O rustup-init
chmod +x rustup-init

./rustup-init
```

Rust rustup download URL patterns:
- amd64: https://static.rust-lang.org/rustup/dist/x86_64-unknown-linux-gnu/rustup-init
- arm64: https://static.rust-lang.org/rustup/dist/aarch64-unknown-linux-gnu/rustup-init
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update install_rust.sh to use $RUSTUP_ARCH variable</name>
  <files>scripts/install_rust.sh</files>
  <action>
Update scripts/install_rust.sh to use the $RUSTUP_ARCH variable instead of hardcoded `x86_64-unknown-linux-gnu`.

Current code (lines 16-21):
```bash
#curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

wget https://static.rust-lang.org/rustup/dist/x86_64-unknown-linux-gnu/rustup-init -O rustup-init
chmod +x rustup-init

./rustup-init
```

Replace with:
```bash
# Download Rustup for detected architecture
wget "https://static.rust-lang.org/rustup/dist/${RUSTUP_ARCH}/rustup-init" -O rustup-init
chmod +x rustup-init

./rustup-init
```

Key changes:
1. Replace hardcoded `x86_64-unknown-linux-gnu` with `${RUSTUP_ARCH}` in wget URL
2. Add quotes around URL for safety with variable expansion

Do NOT change:
- The commented curl line (leave as alternative reference)
- The `chmod +x rustup-init` command
- The `./rustup-init` execution command
- The `source "${toolpath}/config.sh"` line
- The `set -e` error handling
  </action>
  <verify>
    <automated>grep -q '\${RUSTUP_ARCH}' /Users/slazarov/Documents/Scripts/Python/zhipu-projects/podman-debian/scripts/install_rust.sh && ! grep -q 'x86_64-unknown-linux-gnu' /Users/slazarov/Documents/Scripts/Python/zhipu-projects/podman-debian/scripts/install_rust.sh && echo "PASS: RUSTUP_ARCH used, hardcoded target removed" || echo "FAIL: still has hardcoded architecture"</automated>
  </verify>
  <done>install_rust.sh uses ${RUSTUP_ARCH} variable in download URL; no hardcoded target triple references remain</done>
</task>

</tasks>

<verification>
After completion:
1. Verify wget URL contains ${RUSTUP_ARCH} not hardcoded target triple
2. Run `bash -n scripts/install_rust.sh` to verify syntax is valid
3. Verify chmod and execution commands unchanged
</verification>

<success_criteria>
- [ ] scripts/install_rust.sh uses ${RUSTUP_ARCH} in download URL
- [ ] No hardcoded target triple references (x86_64-unknown-linux-gnu) in wget command
- [ ] Script syntax is valid (bash -n passes)
- [ ] chmod and execution commands remain unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/01-architecture-support/01-04-SUMMARY.md`
</output>
