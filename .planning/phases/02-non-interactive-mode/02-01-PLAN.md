---
phase: 02-non-interactive-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - install.sh
  - scripts/install_rust.sh
autonomous: true
requirements:
  - NINT-01
  - NINT-02
  - NINT-03
  - NINT-04
user_setup: []

must_haves:
  truths:
    - "User can start install.sh and walk away - it completes without any input"
    - "No apt-get commands prompt for confirmation"
    - "No package configuration dialogs appear during installation"
    - "Rust installer does not prompt for confirmation"
  artifacts:
    - path: "install.sh"
      provides: "Main entry point with non-interactive environment"
      contains: "export DEBIAN_FRONTEND=noninteractive"
    - path: "scripts/install_rust.sh"
      provides: "Non-interactive Rust installation"
      contains: "rustup-init -y"
    - path: "scripts/install_dependencies.sh"
      provides: "Non-interactive apt package installation"
      pattern: "apt(-get)? install -y"
  key_links:
    - from: "install.sh"
      to: "all sourced scripts"
      via: "export DEBIAN_FRONTEND"
      pattern: "export DEBIAN_FRONTEND=noninteractive"
    - from: "scripts/install_rust.sh"
      to: "rustup-init binary"
      via: "-y flag"
      pattern: "rustup-init -y"
---

<objective>
Enable fully non-interactive installation by setting DEBIAN_FRONTEND globally and adding -y flag to rustup-init.

Purpose: User can start install.sh and walk away - the installation completes without any input required.
Output: Modified install.sh with DEBIAN_FRONTEND export, modified install_rust.sh with -y flag.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-non-interactive-mode/02-CONTEXT.md
@.planning/phases/02-non-interactive-mode/02-RESEARCH.md
</context>

<interfaces>
<!-- Key codebase patterns executor needs. Extracted from codebase. -->

From install.sh (current state):
```bash
#!/bin/bash

# Abort on Error
# set -e

# Determine toolpath if not set already
relativepath="./"
if [[ ! -v toolpath ]]; then scriptpath=$(cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd ); toolpath=$(realpath --canonicalize-missing ${scriptpath}/${relativepath}); fi

# Load Configuration
source "${toolpath}/config.sh"
# ... (sources 15+ scripts)
```

From scripts/install_rust.sh (current state, line 20):
```bash
./rustup-init
```

From scripts/install_dependencies.sh (verified - all have -y flag):
```bash
apt-get install -y libapparmor-dev
sudo apt-get install -y git iptables ...
sudo apt-get install -y make git gcc build-essential ...
sudo apt-get install -y libglib2.0-dev libslirp-dev ...
apt install -y libfuse3-dev
apt install -y libsubid-dev meson codespell cmake
apt install -y systemd-dev
apt install -y unzip
```
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Add DEBIAN_FRONTEND=noninteractive to install.sh</name>
  <files>install.sh</files>
  <action>
    Add `export DEBIAN_FRONTEND=noninteractive` to install.sh immediately after the shebang and before any other commands.

    Insert after line 1 (`#!/bin/bash`) and before line 3 (`# Abort on Error`):
    ```bash
    # Non-Interactive Mode - MUST be set before ANY apt commands
    export DEBIAN_FRONTEND=noninteractive
    ```

    This placement ensures the environment variable is set BEFORE any sub-scripts are sourced, propagating to all child processes. This addresses NINT-01 and NINT-04 (accepts all package defaults, no debconf pre-seeding needed per user decision).
  </action>
  <verify>
    <automated>grep -q 'export DEBIAN_FRONTEND=noninteractive' install.sh && echo "PASS: DEBIAN_FRONTEND found" || echo "FAIL: DEBIAN_FRONTEND missing"</automated>
  </verify>
  <done>install.sh exports DEBIAN_FRONTEND=noninteractive before sourcing any sub-scripts</done>
</task>

<task type="auto">
  <name>Task 2: Add -y flag to rustup-init command</name>
  <files>scripts/install_rust.sh</files>
  <action>
    Change line 20 from:
    ```bash
    ./rustup-init
    ```
    to:
    ```bash
    ./rustup-init -y
    ```

    The `-y` flag auto-accepts the Rust installation without prompting for confirmation. Per user decision in CONTEXT.md: "Rustup: pass -y flag to auto-accept installation (`rustup-init -y`)"
  </action>
  <verify>
    <automated>grep -q 'rustup-init -y' scripts/install_rust.sh && echo "PASS: rustup-init has -y flag" || echo "FAIL: rustup-init missing -y flag"</automated>
  </verify>
  <done>scripts/install_rust.sh runs rustup-init with -y flag for silent installation</done>
</task>

<task type="auto">
  <name>Task 3: Verify all apt commands have -y flag (already compliant)</name>
  <files>scripts/install_dependencies.sh</files>
  <action>
    Run verification to confirm all apt commands in scripts/install_dependencies.sh have the -y flag. This is a verification task - no modifications expected since research confirmed all 8 apt commands already have -y flag.

    Verification command:
    ```bash
    grep -E 'apt(-get)?\s+(install|update|upgrade|remove)' scripts/install_dependencies.sh | grep -v -- '-y'
    ```

    If the output is empty, all apt commands have -y flag (PASS). If any lines appear, those commands need -y flag added (FAIL - fix them).

    This addresses NINT-02 verification.
  </action>
  <verify>
    <automated>! grep -E 'apt(-get)?\s+(install|update|upgrade|remove)' scripts/install_dependencies.sh | grep -v -- '-y' | grep -q . && echo "PASS: All apt commands have -y flag" || echo "FAIL: Some apt commands missing -y flag"</automated>
  </verify>
  <done>All apt commands in install_dependencies.sh confirmed to have -y flag</done>
</task>

<task type="auto">
  <name>Task 4: Verify no blocking input commands exist (already compliant)</name>
  <files>*.sh, scripts/*.sh</files>
  <action>
    Run verification to confirm no blocking input commands (read, select, dialog, whiptail) exist in any shell script. This is a verification task - no modifications expected since research confirmed no blocking commands exist.

    Verification commands:
    ```bash
    # Check for read commands
    grep -rn '\bread\b' *.sh scripts/*.sh 2>/dev/null

    # Check for select commands
    grep -rn '\bselect\b' *.sh scripts/*.sh 2>/dev/null

    # Check for dialog/whiptail
    grep -rn 'dialog\|whiptail' *.sh scripts/*.sh 2>/dev/null
    ```

    All commands should return "No matches found" (PASS). If any matches appear, those are blocking commands that need removal (FAIL - remove them).

    This addresses NINT-03 verification.
  </action>
  <verify>
    <automated>
      (
        ! grep -rn '\bread\b' *.sh scripts/*.sh 2>/dev/null | grep -q . &&
        ! grep -rn '\bselect\b' *.sh scripts/*.sh 2>/dev/null | grep -q . &&
        ! grep -rn 'dialog\|whiptail' *.sh scripts/*.sh 2>/dev/null | grep -q .
      ) && echo "PASS: No blocking input commands found" || echo "FAIL: Blocking input commands detected"
    </automated>
  </verify>
  <done>No read, select, dialog, or whiptail commands exist in any shell script</done>
</task>

</tasks>

<verification>
After all tasks complete, run full verification suite:

```bash
# 1. Verify DEBIAN_FRONTEND is set
grep -n 'DEBIAN_FRONTEND=noninteractive' install.sh

# 2. Verify rustup-init has -y flag
grep -n 'rustup-init -y' scripts/install_rust.sh

# 3. Verify all apt commands have -y flag (should return empty = all have -y)
grep -E 'apt(-get)?\s+(install|update|upgrade|remove)' scripts/install_dependencies.sh | grep -v -- '-y'

# 4. Verify no blocking input commands (should all return empty)
grep -rn '\bread\b' *.sh scripts/*.sh 2>/dev/null
grep -rn '\bselect\b' *.sh scripts/*.sh 2>/dev/null
grep -rn 'dialog\|whiptail' *.sh scripts/*.sh 2>/dev/null
```

All checks should pass.
</verification>

<success_criteria>
- [x] NINT-01: DEBIAN_FRONTEND=noninteractive exported in install.sh before sourcing sub-scripts
- [x] NINT-02: All apt commands in install_dependencies.sh have -y flag (verified)
- [x] NINT-03: No read, select, dialog, or whiptail commands in any .sh file (verified)
- [x] NINT-04: Package configuration prompts handled by DEBIAN_FRONTEND=noninteractive (no debconf pre-seeding needed per user decision)
- [x] User can start install.sh and walk away - installation completes without any input
</success_criteria>

<output>
After completion, create `.planning/phases/02-non-interactive-mode/02-01-SUMMARY.md`
</output>
